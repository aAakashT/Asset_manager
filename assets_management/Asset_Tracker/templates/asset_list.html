{% extends 'base.html' %}

{% block content %}
<h2>Asset List</h2>
<table id="asset-table" class="table table-striped">
    <thead>
        <tr>          
            <th>ID</th>
            <th>asset_name</th>
            <th>asset_code</th>
            <th>asset_type</th>
            <th>is_active</th>
            <th>created_at</th>
            <th>updated_at</th>
            <th>image</th>
            <th>actions</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<script>
    $(document).ready(function() {
        $('#asset-table').DataTable({ 
            "processing": true,
            "serverSide": true,
            "ajax": "{% url 'assets_data' %}",
            "columns": [
                {"data": "id"},
                {"data": "asset_name"},
                {"data": "asset_code"},
                {"data": "asset_type"},
                {"data": "is_actve",
                render: function(data) {
                  if (data == 'True') {
            return 'True';
          } else {
            return 'False';}
          }
        },
                {"data": "created_at"},
                {"data": "updated_at"},

      {
  "data": '_prefetched_objects_cache',
  render: function(data, type, row) {
    var imageHTML = '';
    if (data && data.length > 0) {
      for (var i = 0; i < data.length; i++) {
        var imageUrl = data[i].image;
        imageHTML = '<img src="' + imageUrl + '" alt="Image">';
      }
    }
    return imageHTML;
  }
},
            {
    "data": null,
    "render": function(data, type, row) {
      return '<button class="btn btn-primary update-btn" data-id="' + row.id + '">Update</button>'+
      '<button class="btn btn-danger delete-btn" data-id="' + row.id + '">Delete</button>';
    }
  },

]
});
  
});
$('#asset-table').on('click', '.update-btn', function() {
        var assetId1 = $(this).data('id');
    
        window.location.href = '' + assetId1 + '/update/';
      });

// Delete Record
$('#asset-table').on('click', '.delete-btn', function() {
var assetId = $(this).data('id');
var confirmation = confirm('Are you sure you want to delete this record?');
if (confirmation) {
$.ajax({
url: '/assets/' + assetId + '/delete/',
type: 'POST',
data: {
csrfmiddlewaretoken: '{{ csrf_token }}'
},
success: function(response) {
alert('Record deleted successfully.');
$('#asset-table').DataTable().ajax.reload();
},
error: function(xhr, status, error) {
alert('An error occurred while deleting the record.');
}
});
}
});

</script> 

<br><script>
    function visitPa(){
      window.location.href = '/assets/create/';
    }
  </script><button onclick="visitPa();">CreateAsset</button></br>
{% endblock %}
